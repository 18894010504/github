<!DOCTYPE html>
<html>
    <head>
        <title>Editor</title>
        <meta charset="UTF-8">   
        <style>
            html, body {
                padding: 0px;
                margin: 0px;                
            }            
            .main {
                margin: 0px;
                padding: 0px;
                position: absolute;
                top: 0px;
                bottom: 0px;
                left: 0px;
                right: 0px;
            }
        </style>     
        <script src="./ht-4.3/js/ht.js"></script>   
        <script src="./ht-4.3/js/editor/CreateNodeInteractor.js"></script>
        <script src="./ht-4.3/js/editor/CreateEdgeInteractor.js"></script>
        <script src="./ht-4.3/js/editor/CreateShapeInteractor.js"></script>
        <script>
            var datas = '{"v":"1.0","d":[]}';
            r = ht.Default.setImage;
                        
            ['zoomIn', 'zoomOut', 'fitContent', 'default', 'edit', 'shape', 'node', 'edge'].forEach(function(name){
                ht.Default.setImage(name, './ht-4.3/js/editor/' + name + '.png');
            });
            
            function init() {
                items = [
                    {
                        icon: 'zoomIn',
                        action: function() {
                            graphView.zoomIn(true);
                        }
                    },
                    {
                        icon: 'zoomOut',
                        action: function() {
                            graphView.zoomOut(true);
                        }
                    },
                    {
                        icon: 'fitContent',
                        action: function() {
                            graphView.fitContent(true);
                        }
                    },
                    "separator",
                    {
                        icon: 'default',
                        groupId: 'interaction',
                        action: function() {
                            graphView.setEditable(false);
                        }
                    },
                    {
                        icon: 'edit',
                        groupId: 'interaction',
                        action: function() {
                            graphView.setEditable(true);
                        }
                    },
                    {
                        icon: 'node',
                        groupId: 'interaction',
                        action: function() {
                            graphView.setInteractors([
                                new ht.graph.DefaultInteractor(graphView),
                                new ht.graph.TouchInteractor(graphView, {
                                    selectable: false
                                }),
                                new CreateNodeInteractor(graphView)
                            ]);
                        }
                    },
                    {
                        icon: 'edge',
                        groupId: 'interaction',
                        action: function() {
                            
                            graphView.setInteractors([
                                new ht.graph.DefaultInteractor(graphView),
                                new ht.graph.TouchInteractor(graphView, {
                                    selectable: false
                                }),
                                new CreateEdgeInteractor(graphView)
                            ]);
                        }
                    },
                    {
                        icon: 'shape',
                        groupId: 'interaction',
                        selected: true,
                        action: function() {
                            graphView.setInteractors([
                                new ht.graph.DefaultInteractor(graphView),
                                new ht.graph.TouchInteractor(graphView, {
                                    selectable: false
                                }),
                                new CreateShapeInteractor(graphView)
                            ]);
                        }
                    },
                    "separator",
                    {
                        label: 'Image',
                        action: function() {
                            var doc = window.open().document;
                            doc.open();
                            doc.write("<img src='" + graphView.toDataURL() + "'/>");
                            doc.close();
                            doc.body.style.margin = '0';
                            doc.title = 'Export image at ' + new Date();
                        }
                    },
                    {
                        label: 'JSON',
                        action: function() {
                            var doc = window.open().document;
                            doc.open();
                            doc.write("<pre>" + dataModel.serialize() + "</pre>");
                            doc.close();
                            doc.body.style.margin = '0';
                            doc.title = 'Export JSON at ' + new Date();
                        }
                    }
                ];

                toolbar = new ht.widget.Toolbar(items);

                
                dataModel = new ht.DataModel();

              
                graphView = new ht.graph.GraphView(dataModel);

               

                borderPane = new ht.widget.BorderPane();
                borderPane.setTopView(toolbar);
                borderPane.setCenterView(graphView);

                view = borderPane.getView();
                view.className = 'main';
                document.body.appendChild(view);
                window.addEventListener('resize', function(e) {
                    borderPane.invalidate();
                }, false);


                dataModel.deserialize(datas);

                
                graphView.translate(30, 30);
                graphView.setInteractors([
                    new ht.graph.DefaultInteractor(graphView),
                    new ht.graph.TouchInteractor(graphView, {
                        selectable: false
                    }),
                    new CreateShapeInteractor(graphView)
                ]);

                 var eventType = ht.Default.isTouchable ? 'touchend' : 'mouseup';
                    graphView.getView().addEventListener(eventType, function(e){
                        var data = graphView.getDataAt(e);
                        console.log(data)
                    });
            }
            ;
            
           

        </script>
    </head>
    <body onload="init();">
    </body>
</html>