!function(a,b,c){"use strict";var d="ht",e=d+".widget.",f=a[d],g=f.widget,h=f.Default,i=f.Color,j=h.getInternal(),k=h.removeHTML,l=j.layout,m=h.isTouchable?"touchstart":"mousedown",n=h.getWindowInfo,o=h.getImage,p=h.isLeftButton,q=h.drawCenterImage;g.ComboBox=function(a,b,c,d){var e=this,f=e._view=j.createDiv(),k=e._listView=new g.ListView,l=e._canvas=j.createCanvas(f),n=k._view,o=k.sm();e.setHeight(h.widgetRowHeight),e.setWidth(80),e.setValue(a),e.setValues(b),e.setLabels(c),e.setIcons(d),o.setSelectionMode("single"),k.drawRow=function(a,b,c,d,f,g,h){e.drawRow(a,b,c,d,f,g,h)},f.style.display="inline-block",j.setBorder(f,i.lightGray),n.style.boxShadow="0px 0px 10px "+h.toolTipShadowColor,n.addEventListener("mousemove",function(a){o.ss(k.getDataAt(a))},!1),n.addEventListener("keydown",function(a){if(j.isEnter(a)){var b=o.ld();b&&(e.setValue(b.value),e.close())}j.isEsc(a)&&e.close()},!1),f.addEventListener("keydown",function(a){(j.isDown(a)||j.isUp(a))&&e.open()},!1),k.onDataClicked=function(a){e.setValue(a.value),e.close()},f.addEventListener(m,function(a){if(p(a)){var b=a.target;(b===l||b===f)&&(h.preventDefault(a),e.toggle())}},!1),e._handleWindowClick=function(a){if(p(a)){var b=a.target;b===e._input||b===n||b===f||e.close()}},e.iv()},h.def(e+"ComboBox",b,{ms_v:1,ms_fire:1,ms_ac:["dropDownIcon","dropDownWidth","selectIcon","selectIconVisible","indent","background","selectBackground","value","values","labels","icons","editable"],_editable:!1,_selectIconVisible:!1,_background:"white",_dropDownWidth:c,_selectIcon:{width:16,height:16,comps:[{type:"shape",points:[13,3,7,12,4,8],segments:[1,2,2],borderWidth:2,borderColor:i.shape}]},_dropDownIcon:{width:12,height:16,comps:[{type:"shape",points:[1,5,6,11,11,5],segments:[1,2,2],borderWidth:2,borderColor:i.darkGray}]},_selectBackground:i.highlight,_indent:h.widgetIndent,getListView:function(){return this._listView},onPropertyChanged:function(a){this.iv(),"value"===a.property&&this.onValueChanged(a.oldValue,a.newValue)},onValueChanged:function(){},getLabelFont:function(){return h.labelFont},getLabelColor:function(){return h.labelColor},toLabel:function(a){var b=this,c=b._values,d=b._labels;if(d&&c&&d.length===c.length)for(var e=0;e<c.length;e++)if(c[e]===a)return d[e];return null==a?"":a+""},toIcon:function(a){var b=this,c=b._values,d=b._icons;if(d&&c&&d.length===c.length)for(var e=0;e<c.length;e++)if(c[e]===a)return d[e];return null},drawValue:function(a,b,c,d,e,f){var g=this,i=g._indent,j=g.toLabel(b),k=o(g.toIcon(b));k&&(q(a,k,c+i/2,d+f/2),c+=i),j&&h.drawText(a,j,g.getLabelFont(),g.getLabelColor(),c,d,0,f)},drawRow:function(a,b,c,d,e,f,g){var h=this,i=b.value,k=h._indent;c&&j.fillRect(a,d,e,f,g,h._selectBackground),h._selectIconVisible&&(i===h._value&&q(a,o(h._selectIcon),d+k/2,e+g/2),d+=k),h.drawValue(a,i,d,e,f-k,g)},validateImpl:function(){var a=this,b=a._canvas,c=a._indent,d=a.getWidth(),e=a.getHeight(),f=d-c,g=a._background||"";a._view.style.background=g,a._listView._view.style.background=g,j.setCanvas(b,d,e);var h=j.initContext(b);j.translateAndScale(h,0,0,1),h.clearRect(0,0,d,e),q(h,o(a._dropDownIcon),f+c/2,e/2),h.beginPath(),h.rect(0,0,f,e),h.clip(),a.drawValue(h,a._value,0,0,f,e),h.restore()},isOpened:function(){return!!this._listView._view.parentNode},open:function(){var b=this,c=b._listView,d=c.dm(),e=b._values||[],g=e.length;if(!b.isOpened()){d.clear();for(var i=0;g>i;i++){var k=new f.Data,o=e[i];k.setName(b.toLabel(o)),k.value=o,d.add(k),o===b._value&&d.sm().ss(k)}var p=n(),q=p.left,r=p.top,s=p.height,t=b._view.getBoundingClientRect(),u=t.left+q,v=t.top+r,w=t.height,x=b.getIndent(),y=b.getWidth(),z=b.getHeight(),A=b._selectIconVisible?x:0,B=u-A+2,C=v+w,D=b.getDropDownWidth()||y+A,E=g*z;if(c.setRowHeight(z),C+E>r+s&&(v-r>r+s-v-w?(E=Math.min(E,v-r),C=v-E):E=r+s-C),b._editable){var F=b._input=h.createElement("input",b.getSelectBackground(),b.getLabelFont(),b.toLabel(b._value));document.body.appendChild(F),l(F,u,v+1,y-x,z),F.addEventListener("keydown",function(a){j.isEnter(a)?b.setInputValue(F):j.isEsc(a)&&b.close()},!1),b.onInputCreated(F)}document.body.appendChild(c.getView()),l(c,B,C,D,E),c.setFocus(),a.addEventListener(m,b._handleWindowClick,!1),b.onOpened&&b.onOpened()}},onInputCreated:function(){},setInputValue:function(a){var b=this,c=b._labels,d=b._values,e=a.value;if(c)for(var f=0;f<c.length;f++)e===c[f]&&(e=d[f]);"string"==typeof e&&d&&d.length&&"number"==typeof d[0]&&(e=parseFloat(e)),b.setValue(e),b.close()},close:function(){var b=this;b.isOpened()&&(k(b._listView._view),b._input&&(k(b._input),delete b._input),a.removeEventListener(m,b._handleWindowClick,!1),b.onClosed&&b.onClosed()),b.setFocus()},toggle:function(){var a=this;a.isOpened()?a.close():a.open()}})}(this,Object);