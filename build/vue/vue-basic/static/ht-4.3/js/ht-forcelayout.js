!function(V,L){"use strict";var G="ht",y=G+".layout.",l=V[G]||module.parent.exports.ht,c=l.List,R=l.DataModel,T=l.Node,q=l.Edge,r=l.Group,v=Math,B=v.sqrt,P=v.random,S=v.max,f=v.min,g=function(U){return U*U};l.Default.getInternal().addMSMap({ms_force:function(_){_._interval=50,_._stepCount=10,_._motionLimit=.01,_._edgeRepulsion=.65,_._nodeRepulsion=.65,_._damper=1,_._maxMotion=0,_._motionRatio=0,_.init=function(E){var C=this;E instanceof R?C.dm=E:C.gv=E,C._nodeMap={},C._nodes=new c,C._edges=new c},_.start=function(){var O=this,C=O.gv;if(!O._timer){var Z=O.cdm=C?C.dm():O.dm;Z.mm(O.handleDataModelChange,O),Z.md(O.handleDataPropertyChange,O),C&&C.mp(O.handleGV,O),Z.each(function(c){if(O.isVisible(c)&&O.isLayoutable(c)&&c instanceof T)if(O instanceof d){var $=c.p3();c.p3([$[0]+P(),$[1]+P(),$[2]+P()])}else $=c.p(),c.p($.x+P(),$.y+P())}),O._timer=setInterval(function(){O.relax()},O._interval),O._damper=1}},_.stop=function(){var d=this;d._timer&&(d.cdm.umm(d.handleDataModelChange,d),d.cdm.umd(d.handleDataPropertyChange,d),d.gv&&d.gv.ump(d.handleGV,d),clearInterval(d._timer),delete d._timer,delete d.cdm)},_.handleGV=function(F){var g=this;if("dataModel"===F.property){var E=F.oldValue,h=F.newValue;E&&(E.umm(g.handleDataModelChange,g),E.umd(g.handleDataPropertyChange,g)),this.cdm=h,h.mm(g.handleDataModelChange,g),h.md(g.handleDataPropertyChange,g)}},_.relax=function(){var Z=this;if(!(Z._damper<.1&&Z._maxMotion<Z._motionLimit)){this.cdm.each(function(s){Z.isVisible(s)&&(s instanceof q?Z.addEdge(s):s instanceof T&&Z.addNode(s))});for(var R,w,K=0,g=Z._edges,U=Z._nodes,m=U.size();K<Z._stepCount;K++){for(g.each(Z.relaxEdge,Z),R=0;m>R;R++)for(w=0;m>w;w++)Z.relaxNode(U.get(R),U.get(w));Z.moveNode()}Z._isAdjusting=1,U.each(function(P){P.fix||(P.p?P.v.p3(P.p):P.v.p(P.x,P.y))}),delete Z._isAdjusting,Z._nodeMap={},U.clear(),g.clear(),Z.onRelaxed()}},_.onRelaxed=function(){},_.isRunning=function(){return!!this._timer},_.isVisible=function(S){return S.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(S):!0},_.isLayoutable=function(B){if(B.s("layoutable")===!1)return!1;if(B instanceof r)return!1;var O=this;return O.gv?O.gv.isMovable(B)&&!O.gv.isSelected(B):!(O.cdm||O.dm).sm().co(B)},_.getNodeRepulsion=function(){return this._nodeRepulsion},_.setNodeRepulsion=function(d){this._nodeRepulsion=d,this._damper=1},_.getEdgeRepulsion=function(){return this._edgeRepulsion},_.setEdgeRepulsion=function(h){this._edgeRepulsion=h,this._damper=1},_.getStepCount=function(){return this._stepCount},_.setStepCount=function(d){this._stepCount=d,this._damper=1},_.getInterval=function(){return this._interval},_.setInterval=function($){var G=this;G._interval!==$&&(G._interval=$,G._timer&&(clearInterval(G._timer),G._timer=setInterval(function(){G.relax()},$)))},_.handleDataPropertyChange=function(C){!this._isAdjusting&&this.isVisible(C.data)&&(this._damper=1)},_.handleDataModelChange=function(){this._damper=1},_.damp=function(){var O=this._maxMotion,V=this._damper;this._motionRatio<=.001&&((.2>O||O>1&&.9>V)&&V>.01?this._damper-=.01:.4>O&&V>.003?this._damper-=.003:V>1e-4&&(this._damper-=1e-4)),O<this._motionLimit&&(this._damper=0)}}}),l.layout.ForceLayout=function(T){this.init(T)},l.Default.def(y+"ForceLayout",L,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(u){this._limitBounds=u,this._damper=1},getNodeSize:function(v){var p=this.gv;return p&&p.getDataUIBounds?p.getDataUIBounds(v):v.getRect()},addNode:function(w){var E=this,K=E._nodeMap[w._id];if(K)return K;var l=w.p();K={v:w,x:l.x,y:l.y,dx:0,dy:0,fix:!E.isLayoutable(w),s:E.getNodeSize(w)};var P=K.s,q=B(g(P.width)+g(P.height))*E._nodeRepulsion;return K.r=1>q?100:q,E._nodeMap[w._id]=K,E._nodes.add(K),K},addEdge:function(m){if(m._40I&&m._41I){var x=this,O=x.addNode(m._40I),q=x.addNode(m._41I),X={s:O,t:q};q=q.s,O=O.s;var w=q.width+O.width,h=q.height+O.height;X.length=B(w*w+h*h)*x._edgeRepulsion,X.length<=0&&(X.length=100),x._edges.add(X)}},relaxEdge:function(Z){var r=Z.t,M=Z.s,y=r.x-M.x,R=r.y-M.y,j=B(y*y+R*R),f=100*Z.length,q=.25*y/f*j,e=.25*R/f*j;r.dx=r.dx-q,r.dy=r.dy-e,M.dx=M.dx+q,M.dy=M.dy+e},relaxNode:function(T,H){if(T!==H){var J=0,l=0,Z=T.x-H.x,G=T.y-H.y,V=Z*Z+G*G;0===V?(J=P(),l=P()):36e4>V&&(J=Z/V,l=G/V);var C=T.r*H.r/400;J*=C,l*=C,T.dx+=J,T.dy+=l,H.dx-=J,H.dy-=l}},moveNode:function(){var T=this,K=T._limitBounds,X=T._maxMotion,t=0,n=T._damper;T._nodes.each(function(w){if(!w.fix){var N=w.dx*n,U=w.dy*n;if(w.dx=N/2,w.dy=U/2,t=S(B(N*N+U*U),t),w.x+=S(-40,f(40,N)),w.y+=S(-40,f(40,U)),K){w.x<K.x&&(w.x=K.x,T.adjust(1,0)),w.y<K.y&&(w.y=K.y,T.adjust(0,1));var v=w.s;w.x+v.width>K.x+K.width&&(w.x=K.x+K.width-v.width,T.adjust(-1,0)),w.y+v.height>K.y+K.height&&(w.y=K.y+K.height-v.height,T.adjust(0,-1))}}}),T._maxMotion=t,T._motionRatio=t>0?X/t-1:0,T.damp()},adjust:function(B,k){var I=this._limitBounds;this._nodes.each(function(z){B>0?(!I||z.x+z.s.width+B<I.x+I.width)&&(z.x+=B):(!I||z.x+B>I.x)&&(z.x+=B),k>0?(!I||z.y+z.s.height+k<I.y+I.height)&&(z.y+=k):(!I||z.y+k>I.y)&&(z.y+=k)})}});var d=l.layout.Force3dLayout=function(i){this.init(i)};l.Default.def(y+"Force3dLayout",L,{ms_force:1,getNodeSize3d:function(Y){return Y.s3()},addNode:function(w){var o=this,e=o._nodeMap[w._id];if(e)return e;e={v:w,p:w.p3(),d:[0,0,0],fix:!o.isLayoutable(w),s:o.getNodeSize3d(w)};var x=e.s,D=l.Default.getDistance(x)*o._nodeRepulsion;return e.r=1>D?100:D,o._nodeMap[w._id]=e,o._nodes.add(e),e},addEdge:function(Z){if(Z._40I&&Z._41I){var s=this,o=s.addNode(Z._40I),G=s.addNode(Z._41I),z={s:o,t:G};G=G.s,o=o.s,z.length=B(g(G[0]+o[0])+g(G[1]+o[1])+g(G[2]+o[2]))*s._edgeRepulsion,z.length<=0&&(z.length=100),s._edges.add(z)}},relaxEdge:function(c){var S=c.t.p,A=c.s.p,e=c.t.d,b=c.s.d,i=S[0]-A[0],G=S[1]-A[1],K=S[2]-A[2],s=B(i*i+G*G+K*K),M=100*c.length,m=.25*i/M*s,C=.25*G/M*s,I=.25*K/M*s;e[0]-=m,e[1]-=C,e[2]-=I,b[0]+=m,b[1]+=C,b[2]+=I},relaxNode:function(H,d){if(H!==d){var L=H.p,N=d.p,g=0,C=0,u=0,y=L[0]-N[0],_=L[1]-N[1],h=L[2]-N[2],X=y*y+_*_+h*h;0===X?(g=P(),C=P(),u=P()):216e6>X&&(g=y/X,C=_/X,u=h/X);var S=H.r*d.r/400,m=H.d,V=d.d;g*=S,C*=S,u*=S,m[0]+=g,m[1]+=C,m[2]+=u,V[0]-=g,V[1]-=C,V[2]-=u}},moveNode:function(){var j=this,m=j._maxMotion,y=0,M=j._damper;j._nodes.each(function(b){if(!b.fix){var d=b.p,G=b.d,K=G[0]*M,D=G[1]*M,l=G[2]*M;G[0]=K/2,G[1]=D/2,G[2]=l/2,y=S(B(K*K+D*D+l*l),y),d[0]+=S(-40,f(40,K)),d[1]+=S(-40,f(40,D)),d[2]+=S(-40,f(40,l))}}),j._maxMotion=y,j._motionRatio=y>0?m/y-1:0,j.damp()}})}(this,Object);