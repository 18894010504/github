!function(a){"use strict";var b="ht",c=a[b],d=c.Node,e=c.Default,f=e.def,g=e.getInternal(),h=g.ui(),i=g.draw3DRect,j=function(a){var b=a.getChildren();return b.each(function(a){return a instanceof d&&j(a)?!0:void 0}),a.hasAgentEdges()};e.setImage("port","data:image/png;base64,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");var k=c.BaseEquipment=function(){k.superClass.constructor.call(this),this.s("shape.depth",1),this.s("shape.background","rgb(192, 192, 192)"),this.setImage(null)};f(k,c.Node,{setRotation:null,setImage:function(a){k.superClass.setImage.call(this,a),a?this.s("shape",null):this.s("shape","rect")},getClassName:function(){return"ht.BaseEquipment"}});var l=c.Rack=function(){l.superClass.constructor.call(this),this.init()};f(l,k,{init:function(){this.setSize(150,150)},isAdjustChildrenToTop:function(){return j(this)},getClassName:function(){return"ht.Rack"}});var m=c.graph.ShelfUI=function(a,b){m.superClass.constructor.call(this,a,b)};f(m,h.NodeUI,{drawBody:function(a){h.NodeUI.prototype.drawBody.call(this,a);var b=this._data,c=b.s("shape.background");if(a.save(),null!=c){var d=b.getEquipCount();a.strokeStyle=c;for(var e=0;d>e;e++){var f=b.getEquipBoundsByIndex(e);i(a,c,-1,f)}}a.restore()}});var n=c.Shelf=function(){n.superClass.constructor.call(this),this.init()};f(n,k,{ms_ac:["equipCount","equipIndex"],init:function(){/*this.setSize(100,80),*/this._equipCount=-1,this._equipIndex=-1,this.s("shelf.border",2),this.s("shelf.inner.border",1)},isAdjustChildrenToTop:function(){return j(this)},handleHostPropertyChange:function(a){n.superClass.handleHostPropertyChange.call(this,a);var b=a.property;["s:equip.direction","equipCount","width","height","position","s:shelf.border","s:shelf.inner.border"].indexOf(b)>=0&&this.adjustBounds()},onPropertyChanged:function(a){n.superClass.onPropertyChanged.call(this,a),("equipIndex"===a.property||"host"===a.property)&&this.adjustBounds()},adjustBounds:function(){var a=this,b=a.getHost();if(b instanceof n){var c=b,d=a._equipIndex;if(d>=0&&d<c.getEquipCount()){var e=c.getEquipBoundsByIndex(d);null!=e&&(a.setPosition(e.x+e.width/2,e.y+e.height/2),a.setSize(e.width,e.height))}}},getEquipBoundsByIndex:function(a){var b=this,c=b._equipCount;if(0>=c||0>a||a>=c)return null;var d=b.s("shelf.border")||0,e=b.s("shelf.inner.border")||0,f=b.getPosition(),g=b.getWidth(),h=b.getHeight(),i=f.x-g/2+d,j=f.y-h/2+d,k=g-2*d,l=h-2*d;if("v"===b.s("equip.direction")){var m=k/c;i+=m*a;var n={x:i+e,y:j+e,width:m-2*e,height:l-2*e};return n}var m=l/c;j+=m*a;var n={x:i+e,y:j+e,width:k-2*e,height:m-2*e};return n},getClassName:function(){return"ht.Shelf"},getUIClass:function(){return m},getSerializableProperties:function(){var a=n.superClass.getSerializableProperties.call(this);return a.equipCount=1,a.equipIndex=1,a}});var o=c.graph.SlotUI=function(a,b){o.superClass.constructor.call(this,a,b)};f(o,h.NodeUI,{rectIntersects:function(a){return e.intersectsRect(a,this._data.getRect())},drawBody:function(a){var b=this,c=(b.gv,b._data),d=b._nodeInfo,e=d.rect,f=e,g=d.shape,h=c.getEquipCount();if(a.save(),e.width>0&&e.height>0&&g){var j=c.s("shape.background.visible"),k=d.shapeBackground;if(k&&j&&(a.fillStyle=k,a.beginPath(),a.rect(f.x,f.y,f.width,f.height),a.fill()),i(a,k,d.shapeDepth,f),h>0){a.strokeStyle=k;for(var l=0;h>l;l++){var e=c.getEquipBoundsByIndex(l);e.x-=1,e.y-=1,e.width+=1,e.height+=1,i(a,k,-1,e)}}}a.restore()}});var p=c.Slot=function(){this._cards=new c.List,p.superClass.constructor.call(this),this.init()};f(p,k,{ms_ac:["equipCount","equipIndex"],init:function(){this.setSize(35,105),this._equipCount=1,this._equipIndex=-1,this.s("slot.border",2),this.s("slot.inner.border",1),this.s("shape.background.visible",!1)},handleHostPropertyChange:function(a){p.superClass.handleHostPropertyChange.call(this,a);var b=a.property;["position","s:equip.direction","equipCount","width","height","s:shelf.border","s:shelf.inner.border","s:slot.border","s:slot.inner.border"].indexOf(b)>=0&&this.adjustBounds()},onPropertyChanged:function(a){p.superClass.onPropertyChanged.call(this,a),this._cards.each(function(b){b.handleHostPropertyChange(a)}),("equipIndex"===a.property||"host"===a.property)&&this.adjustBounds()},adjustBounds:function(){var a=this,b=a.getHost(),c=a._equipIndex;if((b instanceof n||b instanceof p)&&c>=0&&c<b.getEquipCount()){var d=b.getEquipBoundsByIndex(c);null!=d&&(this.setPosition(d.x+d.width/2,d.y+d.height/2),this.setSize(d.width,d.height))}},getEquipBoundsByIndex:function(a){var b=this,c=b._equipCount;if(0>=c||0>a||a>=c)return null;var d=b.s("slot.border")||0,e=b.s("slot.inner.border")||0,f=b.getPosition(),g=b.getWidth(),h=b.getHeight(),i=f.x-g/2+d,j=f.y-h/2+d,k=g-2*d,l=h-2*d;if("v"===b.s("equip.direction")){var m=k/c;i+=m*a;var n={x:i+e,y:j+e,width:m-2*e,height:l-2*e};return n}var m=l/c;j+=m*a;var n={x:i+e,y:j+e,width:k-2*e,height:m-2*e};return n},getClassName:function(){return"ht.Slot"},getUIClass:function(){return o},getSerializableProperties:function(){var a=p.superClass.getSerializableProperties.call(this);return a.equipCount=1,a.equipIndex=1,a}});var q=c.graph.CardUI=function(a,b){q.superClass.constructor.call(this,a,b)};f(q,h.NodeUI,{});var r=c.Card=function(){r.superClass.constructor.call(this),this.init()};f(r,k,{ms_ac:["startIndex","spanCount","occupiedSlots"],init:function(){this._startIndex=0,this._spanCount=0,this.setSize(30,100),this.s("label.position",17)},isAdjustChildrenToTop:function(){return j(this)},handleHostPropertyChange:function(a){r.superClass.handleHostPropertyChange.call(this,a);var b=a.property;["position","width","height","equipCount","s:equip.direction","s:slot.border","s:slot.inner.border"].indexOf(b)>=0&&this.adjustBounds()},onPropertyChanged:function(a){r.superClass.onPropertyChanged.call(this,a),(a.property.indexOf("card.extend.")>=0||"startIndex"===a.property||"spanCount"===a.property||"host"===a.property||"occupiedSlots"===a.property)&&this.adjustBounds()},setOccupiedSlots:function(a){var b=this,c=b._occupiedSlots;c&&c.forEach(function(a){a.remove(b)}),a.forEach(function(a){a._cards.contains(b)||a._cards.add(b)}),b._occupiedSlots=a,this.fp("occupiedSlots",c,a)},adjustBounds:function(){var a,b=this,c=b.getHost(),d=b._occupiedSlots;if(d&&d.length>0)d.forEach(function(b){var c=b.getRect();a=a?e.unionRect(a,c):{x:c.x,y:c.y,width:c.width,height:c.height}}),a&&e.grow(a,-3);else if(c instanceof p){var f=c.getEquipBoundsByIndex(b._startIndex),g=c.getEquipBoundsByIndex(b._startIndex+b._spanCount);if(null!=f&&null!=g?(f=e.unionRect(f,g),a=f):a=c.getEquipBoundsByIndex(0),null!=a){var h=this.s("card.extend.percent");if(null!=h){var i=c.getEquipBoundsByIndex(0);if(0!=h[0]){var j=i.height*h[0];a.y-=j,a.height+=j}if(0!=h[1]){var j=i.width*h[1];a.x-=j,a.width+=j}if(0!=h[2]){var j=i.height*h[2];a.height+=j}if(0!=h[3]){var j=i.width*h[3];a.width+=j}}var k=this.s("card.extend.pixel");null!=k&&(0!=k[0]&&(a.y-=k[0],a.height+=k[0]),0!=k[1]&&(a.x-=k[1],a.width+=k[1]),0!=k[2]&&(a.height+=k[2]),0!=k[2]&&(a.width+=k[3]))}}a&&(this.setPosition(a.x+a.width/2,a.y+a.height/2),this.setSize(a.width,a.height))},getClassName:function(){return"ht.Card"},getUIClass:function(){return q},getSerializableProperties:function(){var a=r.superClass.getSerializableProperties.call(this);return a.startIndex=1,a.spanCount=1,a}});var s=c.Port=function(){s.superClass.constructor.call(this),this.setImage("port"),this.setSize(30,30)};f(s,k,{getClassName:function(){return"ht.Port"}})}(this,Object);